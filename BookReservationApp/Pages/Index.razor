@page "/"
@using BookReservationApp.Components
@using BookReservationApp.Data
@using BookReservationApp.Data.Models
@using Microsoft.EntityFrameworkCore
@inject DatabaseService Database

<MudText Typo="Typo.h4" Class="pb-3">Knygos</MudText>

<MudContainer MaxWidth="MaxWidth.False" Class="d-flex gap-10 flex-wrap">
	@foreach (var book in Books)
	{
		<BookCard 
			Id=@book.Id
			ImageURL=@book.ImageURL
			Title=@book.Title
			Description=@book.Description
			ReservedBy=@book.ReservedBy
		/>
	}
</MudContainer>

@code {
	IEnumerable<BookModel>? Books;

	protected override async Task OnInitializedAsync()
	{
		Books = Database.GetBooks();

		Database.DatabaseChanged += DatabaseChanged;

		await base.OnInitializedAsync();
	}

	private async void DatabaseChanged(object sender, IEnumerable<BookModel> books)
	{
		await InvokeAsync(() =>
		{
			Books = books;

			StateHasChanged();
		});
	}
}

